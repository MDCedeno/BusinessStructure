<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <!-- Change this for appropriate web icon -->
  <link rel="icon" type="image/x-icon" href="../img/foodIcon.png" />
  <!-- You can add more common stylesheets here -->
  <link rel="stylesheet" href="../CSS/marketpage.css" />
  <title>AffordaFood</title>
</head>

<body>
  <!-- The header content can go here if needed (like a navigation bar) -->
  <nav>
    <div class="nav-content">
      <div class="logo">
        <img src="../img/foodIcon.png" alt="Icon" class="icon-img" />
        <a href="homepage.html">AffordaFood</a>
      </div>
      <ul class="nav-links">
        <li><a href="homepage.html">Home</a></li>
        <li><a href="mealpage.html">Meal Plans</a></li>
        <li><a href="marketpage.html">Market</a></li>
        <li><a href="howpage.html">How it works</a></li>
        <li><a href="accountpage.html">My Account</a></li>
      </ul>
    </div>
  </nav>

  <script>
    let nav = document.querySelector("nav");
    window.onscroll = function() {
      if (document.documentElement.scrollTop > 20) {
        nav.classList.add("sticky");
      } else {
        nav.classList.remove("sticky");
      }
    };
  </script>

  <div class="top-background">
    <div class="header">
      <h1>MARKET</h1>
    </div>
  </div>

  <!-- The market section with selection -->
  <section class="market">

    <div class="container">
      <header>
        <div class="title">PRODUCT LIST</div>
        <div class="icon-cart">
          <svg
            aria-hidden="true"
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 18 20">
            <path
              stroke="currentColor"
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M6 15a2 2 0 1 0 0 4 2 2 0 0 0 0-4Zm0 0h8m-8 0-1-4m9 4a2 2 0 1 0 0 4 2 2 0 0 0 0-4Zm-9-4h10l2-7H3m2 7L3 4m0 0-.792-3H1" />
          </svg>
          <span>0</span>
        </div>
      </header>
      <div class="listProduct"></div>
    </div>
    <div class="cartTab">
      <h1>SHOPPING CART TAB</h1>
      <div class="listCart"></div>
      <div class="total-price">
        <h3>Total: $<span id="totalAmount">0.00</span></h3>
      </div>
      <div class="btn">
        <button class="close">CLOSE</button>
        <button class="checkOut">CHECK OUT</button>
      </div>
    </div>
  </section>

  <div class="end">
    <div class="content">
      <div class="box">
        <h3>COMPANY INFO</h3>
        <ul>
          <li>About</li>
          <li>Contact</li>
        </ul>
      </div>
      <div class="box">
        <h3>FIND US ONLINE</h3>
        <div class="social-icons">
          <ul class="wrapper">
            <li class="icon facebook">
              <span class="tooltip">Facebook</span>
              <svg
                viewBox="0 0 320 512"
                height="1.2em"
                fill="currentColor"
                xmlns="http://www.w3.org/2000/svg">
                <path
                  d="M279.14 288l14.22-92.66h-88.91v-60.13c0-25.35 12.42-50.06 52.24-50.06h40.42V6.26S260.43 0 225.36 0c-73.22 0-121.08 44.38-121.08 124.72v70.62H22.89V288h81.39v224h100.17V288z"></path>
              </svg>
            </li>
            <li class="icon twitter">
              <span class="tooltip">Twitter</span>
              <svg
                height="1.8em"
                fill="currentColor"
                viewBox="0 0 48 48"
                xmlns="http://www.w3.org/2000/svg"
                class="twitter">
                <path
                  d="M42,12.429c-1.323,0.586-2.746,0.977-4.247,1.162c1.526-0.906,2.7-2.351,3.251-4.058c-1.428,0.837-3.01,1.452-4.693,1.776C34.967,9.884,33.05,9,30.926,9c-4.08,0-7.387,3.278-7.387,7.32c0,0.572,0.067,1.129,0.193,1.67c-6.138-0.308-11.582-3.226-15.224-7.654c-0.64,1.082-1,2.349-1,3.686c0,2.541,1.301,4.778,3.285,6.096c-1.211-0.037-2.351-0.374-3.349-0.914c0,0.022,0,0.055,0,0.086c0,3.551,2.547,6.508,5.923,7.181c-0.617,0.169-1.269,0.263-1.941,0.263c-0.477,0-0.942-0.054-1.392-0.135c0.94,2.902,3.667,5.023,6.898,5.086c-2.528,1.96-5.712,3.134-9.174,3.134c-0.598,0-1.183-0.034-1.761-0.104C9.268,36.786,13.152,38,17.321,38c13.585,0,21.017-11.156,21.017-20.834c0-0.317-0.01-0.633-0.025-0.945C39.763,15.197,41.013,13.905,42,12.429"></path>
              </svg>
            </li>
            <li class="icon instagram">
              <span class="tooltip">Instagram</span>
              <svg
                xmlns="http://www.w3.org/2000/svg"
                height="1.2em"
                fill="currentColor"
                class="bi bi-instagram"
                viewBox="0 0 16 16">
                <path
                  d="M8 0C5.829 0 5.556.01 4.703.048 3.85.088 3.269.222 2.76.42a3.917 3.917 0 0 0-1.417.923A3.927 3.927 0 0 0 .42 2.76C.222 3.268.087 3.85.048 4.7.01 5.555 0 5.827 0 8.001c0 2.172.01 2.444.048 3.297.04.852.174 1.433.372 1.942.205.526.478.972.923 1.417.444.445.89.719 1.416.923.51.198 1.09.333 1.942.372C5.555 15.99 5.827 16 8 16s2.444-.01 3.298-.048c.851-.04 1.434-.174 1.943-.372a3.916 3.916 0 0 0 1.416-.923c.445-.445.718-.891.923-1.417.197-.509.332-1.09.372-1.942C15.99 10.445 16 10.173 16 8s-.01-2.445-.048-3.299c-.04-.851-.175-1.433-.372-1.941a3.926 3.926 0 0 0-.923-1.417A3.911 3.911 0 0 0 13.24.42c-.51-.198-1.092-.333-1.943-.372C10.443.01 10.172 0 7.998 0h.003zm-.717 1.442h.718c2.136 0 2.389.007 3.232.046.78.035 1.204.166 1.486.275.373.145.64.319.92.599.28.28.453.546.598.92.11.281.24.705.275 1.485.039.843.047 1.096.047 3.231s-.008 2.389-.047 3.232c-.035.78-.166 1.203-.275 1.485a2.47 2.47 0 0 1-.599.919c-.28.28-.546.453-.92.598-.28.11-.704.24-1.485.276-.843.038-1.096.047-3.232.047s-2.39-.009-3.233-.047c-.78-.036-1.203-.166-1.485-.276a2.478 2.478 0 0 1-.92-.598 2.48 2.48 0 0 1-.6-.92c-.109-.281-.24-.705-.275-1.485-.038-.843-.046-1.096-.046-3.233 0-2.136.008-2.388.046-3.231.036-.78.166-1.204.276-1.486.145-.373.319-.64.599-.92.28-.28.546-.453.92-.598.282-.11.705-.24 1.485-.276.738-.034 1.024-.044 2.515-.045v.002zm4.988 1.328a.96.96 0 1 0 0 1.92.96.96 0 0 0 0-1.92zm-4.27 1.122a4.109 4.109 0 1 0 0 8.217 4.109 4.109 0 0 0 0-8.217zm0 1.441a2.667 2.667 0 1 1 0 5.334 2.667 2.667 0 0 1 0-5.334z"></path>
              </svg>
            </li>
          </ul>
        </div>
      </div>
      <div class="box">
        <h3>TALK TO US</h3>
        <ul>
          <li>09512175423</li>
          <li>affordafood@gmail.com</li>
        </ul>
      </div>
    </div>
    <div class="footer">
      <div class="logo">
        <img src="../img/foodIcon.png" alt="Icon" class="icon-img" />
        <a href="homepage.html">AffordaFood</a>
      </div>
      <p>Privacy Policy - Terms of Service - FAQ's</p>
      <p>© 2022 AffordaFood. All rights reserved.</p>
    </div>
  </div>
</body>

</html>

<!-- <script src="app.js"></script> -->
<script>
  let listProductHTML = document.querySelector(".listProduct");
  let listCartHTML = document.querySelector(".listCart");
  let iconCart = document.querySelector(".icon-cart");
  let iconCartSpan = document.querySelector(".icon-cart span");
  let totalPriceElement = document.querySelector(".total-price"); // Add this to your HTML to display total price
  let body = document.querySelector("body");
  let closeCart = document.querySelector(".close");
  let products = [];
  let cart = [];

  iconCart.addEventListener("click", () => {
    body.classList.toggle("showCart");
  });
  closeCart.addEventListener("click", () => {
    body.classList.toggle("showCart");
  });

  const addDataToHTML = () => {
    if (products.length > 0) {
      products.forEach((product) => {
        let newProduct = document.createElement("div");
        newProduct.dataset.id = product.id;
        newProduct.classList.add("item");
        newProduct.innerHTML = `<img src="${product.image}" alt="">
                <h2>${product.name}</h2>
                <div class="price">₱${product.price}</div>
                <button class="addCart">Add To Cart</button>`;
        listProductHTML.appendChild(newProduct);
      });
    }
  };

  listProductHTML.addEventListener("click", (event) => {
    let positionClick = event.target;
    if (positionClick.classList.contains("addCart")) {
      let id_product = positionClick.parentElement.dataset.id;
      addToCart(id_product);
    }
  });

  const addToCart = (product_id) => {
    let positionThisProductInCart = cart.findIndex(
      (value) => value.product_id == product_id
    );
    if (cart.length <= 0) {
      cart = [{
        product_id: product_id,
        quantity: 1,
      }, ];
    } else if (positionThisProductInCart < 0) {
      cart.push({
        product_id: product_id,
        quantity: 1,
      });
    } else {
      cart[positionThisProductInCart].quantity += 1;
    }
    addCartToHTML();
    addCartToMemory();
  };

  const addCartToMemory = () => {
    localStorage.setItem("cart", JSON.stringify(cart));
  };

  const addCartToHTML = () => {
    listCartHTML.innerHTML = "";
    let totalQuantity = 0;
    if (cart.length > 0) {
      cart.forEach((item) => {
        totalQuantity += item.quantity;
        let newItem = document.createElement("div");
        newItem.classList.add("item");
        newItem.dataset.id = item.product_id;

        let positionProduct = products.findIndex(
          (value) => value.id == item.product_id
        );
        let info = products[positionProduct];
        listCartHTML.appendChild(newItem);
        newItem.innerHTML = `
            <div class="image">
                    <img src="${info.image}">
                </div>
                <div class="name">
                ${info.name}
                </div>
                <div class="totalPrice">₱${info.price * item.quantity}</div>
                <div class="quantity">
                    <span class="minus"><</span>
                    <span>${item.quantity}</span>
                    <span class="plus">></span>
                </div>
            `;
      });
    }
    iconCartSpan.innerText = totalQuantity;
    updateTotalPrice(); // Call the total price update function here
  };

  const updateTotalPrice = () => {
    let totalPrice = 0;
    cart.forEach((item) => {
      let product = products.find((p) => p.id == item.product_id);
      if (product) {
        totalPrice += product.price * item.quantity;
      }
    });
    totalPriceElement.innerText = `Total: ₱${totalPrice.toFixed(2)}`;
  };

  listCartHTML.addEventListener("click", (event) => {
    let positionClick = event.target;
    if (
      positionClick.classList.contains("minus") ||
      positionClick.classList.contains("plus")
    ) {
      let product_id = positionClick.parentElement.parentElement.dataset.id;
      let type = positionClick.classList.contains("plus") ? "plus" : "minus";
      changeQuantityCart(product_id, type);
    }
  });

  const changeQuantityCart = (product_id, type) => {
    let positionItemInCart = cart.findIndex(
      (value) => value.product_id == product_id
    );
    if (positionItemInCart >= 0) {
      let info = cart[positionItemInCart];
      switch (type) {
        case "plus":
          cart[positionItemInCart].quantity += 1;
          break;
        case "minus":
          let newQuantity = cart[positionItemInCart].quantity - 1;
          if (newQuantity > 0) {
            cart[positionItemInCart].quantity = newQuantity;
          } else {
            cart.splice(positionItemInCart, 1);
          }
          break;
      }
    }
    addCartToHTML();
    addCartToMemory();
  };

  document.addEventListener("DOMContentLoaded", () => {
    const initApp = () => {
      // Retrieve the JSON data from the script tag by ID
      const productDataScript = document.getElementById("productData");

      // Check if the element exists before accessing it
      if (productDataScript) {
        // Parse the JSON content inside the script tag
        products = JSON.parse(productDataScript.textContent);
        addDataToHTML();
      } else {
        console.error("Error: #productData script tag not found.");
      }

      // Load the cart from localStorage if it exists
      if (localStorage.getItem("cart")) {
        cart = JSON.parse(localStorage.getItem("cart"));
        addCartToHTML();
      }
    };

    // Initialize the app after DOM is fully loaded
    initApp();
  });
</script>

<!-- Inline JSON data -->
<script type="application/json" id="productData">
  [{
      "id": 1,
      "name": "Caesar Salad",
      "price": 90,
      "image": "../img/caesar.webp"
    },
    {
      "id": 2,
      "name": "Pan Fried Chicken mixed with Vegetables + Extra rice",
      "price": 150,
      "image": "../img/panFried.jpg"
    },
    {
      "id": 3,
      "name": "Stir Fry Chicken with Vegetables",
      "price": 100,
      "image": "../img/stirFry.jpg"
    },
    {
      "id": 4,
      "name": "Pakbet with rice",
      "price": 90,
      "image": "../img/pakbet.jpg"
    },
    {
      "id": 5,
      "name": "Chop Suey with rice",
      "price": 90,
      "image": "../img/chopSuey.jpg"
    },
    {
      "id": 6,
      "name": "Pork Adobong Sitaw",
      "price": 100,
      "image": "../img/adobongSitaw.jpg"
    },
    {
      "id": 7,
      "name": "Nilagang Manok with rice",
      "price": 100,
      "image": "../img/nilaga.jpg"
    },
    {
      "id": 8,
      "name": "Ginataang gulay with rice",
      "price": 100,
      "image": "../img/gata.jpg"
    },
    {
      "id": 9,
      "name": "Ginataang langka with rice",
      "price": 100,
      "image": "../img/langka.jpg"
    },
    {
      "id": 10,
      "name": "Ginataang puso ng saging with rice",
      "price": 100,
      "image": "../img/pusongSaging.jpg"
    },
    {
      "id": 11,
      "name": "Rellenong Bangus with mixed vegetables + rice",
      "price": 150,
      "image": "../img/rellenongbangus.webp"
    },
    {
      "id": 12,
      "name": "Bourbon Chicken with vegetables + rice",
      "price": 150,
      "image": "../img/bourbon.jpg"
    }
  ]
</script>